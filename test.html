<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.11: http://docutils.sourceforge.net/" />
<title>Anki Server</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7614 2013-02-21 15:55:51Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="anki-server">
<h1 class="title">Anki Server</h1>

<p>A personal Anki Server (so you can sync against your own server
rather than AnkiWeb).</p>
<p>It also includes a RESTful API, so that you could implement your
own AnkiWeb if you wanted.</p>
<div class="section" id="installing-the-easy-way">
<h1>Installing the easy way!</h1>
<p>If you have <tt class="docutils literal">easy_install</tt> or <tt class="docutils literal">pip</tt> on your system, you can
simply run:</p>
<pre class="literal-block">
$ easy\_install AnkiSyncServer
</pre>
<p>Or using <tt class="docutils literal">pip</tt>:</p>
<pre class="literal-block">
$ pip install AnkiSyncServer
</pre>
<p>This will give you the latest released version!</p>
<p>However, if you want to try the latest bleeding edge version OR you
want to help with development, you'll need to install from source.
In that case, follow the instructions in the next two sections.</p>
</div>
<div class="section" id="setting-up-a-virtualenv">
<h1>Setting up a virtualenv</h1>
<p>If you want to install your Anki Server in an isolated Python
environment using
<a class="reference external" href="https://pypi.python.org/pypi/virtualenv">virtualenv</a>, please
follow these instructions before going on to the next section. If
not, just skip to the &quot;Installing&quot; section below.</p>
<p>There are many reasons for installing into a virtualenv, rather
than globally on your system:</p>
<ul class="simple">
<li>You can keep the Anki Server's dependencies seperate from other
Python applications.</li>
<li>You don't have permission to install globally on your system
(like on a shared host).</li>
</ul>
<p>Here are step-by-step instruction for setting up your virtualenv:</p>
<ol class="arabic">
<li><p class="first">First, you need to install &quot;virtualenv&quot;. If your system has
<tt class="docutils literal">easy_install</tt> or <tt class="docutils literal">pip</tt>, this is just a matter of:</p>
<pre class="literal-block">
$ easy\_install virtualenv
</pre>
<p>Or using pip:</p>
<pre class="literal-block">
$ pip install virtualenv
</pre>
<p>Or you can use your the package manager provided by your OS.</p>
</li>
<li><p class="first">Next, create your a Python environment for running AnkiServer:</p>
<pre class="literal-block">
$ virtualenv AnkiServer.env
</pre>
</li>
<li><p class="first">(Optional) Enter the virtualenv to save you on typing:</p>
<pre class="literal-block">
$ . AnkiServer.env/bin/activate
</pre>
</li>
</ol>
<p>If you skip step 3, you'll have to type
<tt class="docutils literal">AnkiServer.env/bin/python</tt> instead of <tt class="docutils literal">python</tt> and
<tt class="docutils literal">AnkiServer.env/bin/paster</tt> instead of <tt class="docutils literal">paster</tt> in the next
section.</p>
<p>Also, remember that the environment change in step 3 only lasts as
long as your current terminal session. You'll have to re-enter the
environment if you enter that terminal and come back later.</p>
</div>
<div class="section" id="installing-your-anki-server-from-source">
<h1>Installing your Anki Server from source</h1>
<ol class="arabic">
<li><p class="first">Install all the dependencies we need using <tt class="docutils literal">easy_install</tt> or
<tt class="docutils literal">pip</tt>:</p>
<pre class="literal-block">
$ easy_install webob PasteDeploy PasteScript sqlalchemy simplejson
</pre>
<p>Or using pip:</p>
<pre class="literal-block">
$ pip install webob PasteDeploy PasteScript sqlalchemy simplejson
</pre>
<p>Or you can use your the package manager provided by your OS.</p>
</li>
<li><p class="first">Download and install libanki. You can find the latest release of
Anki here:</p>
<p><a class="reference external" href="http://code.google.com/p/anki/downloads/list">http://code.google.com/p/anki/downloads/list</a></p>
<p>Look for a *.tgz file with a Summary of &quot;Anki Source&quot;. At the time
of this writing that is anki-2.0.11.tgz.</p>
<p>Download this file and extract.</p>
<p>Then either:</p>
<ol class="loweralpha simple">
<li>Run the 'make install', or</li>
<li>Copy the entire directory to /usr/share/anki</li>
</ol>
</li>
<li><p class="first">Make the egg info files (so paster can see our app):</p>
<pre class="literal-block">
$ python setup.py egg\_info
</pre>
</li>
<li><p class="first">Copy the example.ini to production.ini and edit for your needs.</p>
</li>
<li><p class="first">Create authentication database:</p>
<pre class="literal-block">
$ sqlite3 auth.db 'CREATE TABLE auth (user VARCHAR PRIMARY KEY, hash VARCHAR)'
</pre>
</li>
<li><p class="first">Create user:</p>
<pre class="literal-block">
# Enter username and password when prompted.

$ read -p &quot;Username: &quot; USER &amp;&amp; read -sp &quot;Password: &quot; PASS

$ SALT=$(openssl rand -hex 8)

$ HASH=:math:`$(echo -n &quot;$`USER:math:`$PASS$`SALT&quot; \| sha256sum \| sed 's/[ ]\*-:math:`$//')$`SALT

$ sqlite3 auth.db &quot;INSERT INTO auth VALUES (':math:`$USER', '$`HASH')&quot;

$ mkdir -p &quot;collections/$USER&quot;

$ unset USER PASS SALT HASH
</pre>
</li>
<li><p class="first">Then we can run AnkiServer like so:</p>
<pre class="literal-block">
$ paster serve production.ini
</pre>
</li>
</ol>
</div>
<div class="section" id="running-with-supervisor">
<h1>Running with Supervisor</h1>
<p>If you want to run your Anki server persistantly on a Linux (or
other UNIX-y) server, <a class="reference external" href="http://supervisord.org">Supervisor</a> is a
great tool to monitor and manage it. It will allow you to start it
when your server boots, restart it if it crashes and easily access
it's logs.</p>
<ol class="arabic">
<li><p class="first">Install Supervisor on your system. If it's Debian or Ubuntu this
will work:</p>
<pre class="literal-block">
$ sudo apt-get install supervisor
</pre>
<p>If you're using a different OS, please try
<a class="reference external" href="http://supervisord.org/installing.html">these instructions</a>.</p>
</li>
<li><p class="first">Copy <tt class="docutils literal"><span class="pre">supervisor-anki-server.conf</span></tt> to <tt class="docutils literal"><span class="pre">/etc/supervisor/conf.d/anki-server.conf</span></tt>:</p>
<pre class="literal-block">
$ sudo cp supervisor-anki-server.conf /etc/supervisor/conf.d/anki-server.conf
</pre>
</li>
<li><p class="first">Modify <tt class="docutils literal"><span class="pre">/etc/supervisor/conf.d/anki-server.conf</span></tt> to match your
system and how you setup your Anki Server in the section above.</p>
</li>
<li><p class="first">Reload Supervisor's configuration:</p>
<pre class="literal-block">
$ sudo supervisorctl reload
</pre>
</li>
<li><p class="first">Check the logs from the Anki Server to make sure everything is
fine:</p>
<pre class="literal-block">
$ sudo supervisorctl tail anki-server
</pre>
<p>If it's empty - then everything's fine! Otherwise, you'll see an
error message.</p>
</li>
</ol>
<p>Later if you manually want to stop, start or restart it, you can
use:</p>
<pre class="literal-block">
$ sudo supervisorctl stop anki-server

$ sudo supervisorctl start anki-server

$ sudo supervisorctl restart anki-server
</pre>
<p>See the <a class="reference external" href="http://supervisord.org">Supervisor documentation</a> for
more info!</p>
</div>
</div>
</body>
</html>
